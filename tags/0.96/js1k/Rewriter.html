<!DOCTYPE HTML>
<html>
	<head>
		<title>JS1k Demo - Rewriter</title>
		<meta charset="utf-8"/>
	</head>
	<body>
		<canvas id="c"></canvas>
		<script>
            D=document;
            function A(t,a){
                e=D.createElement(t);
                for(i=0;v=a[i++];)
                    e.setAttribute(v[0],v[1]);
                D.body.appendChild(e);
                return e;
            }
            T=A('textarea',[['rows','23'],['cols','80']]);
            C=A('input',[['type','button'],['value','Clear']]);
            P=A('input',[['type','button'],['value','Replay']]);
            N=J=K=0;
            X={
                8:function(){T.value=T.value.slice(0,J!=K?J:J-1)+T.value.slice(K,T.value.length);X[37]()},
                37:function(){if(J>0)J--},
                39:function(){if(J<T.value.length)J++}
            };
            I=[];
            S=[];
            T.onkeydown=function(e){
                if(X[e.keyCode]){
                    if(e.shiftKey)
                        S.push(I.length+2);
                    T.onkeypress(e)
                }
            };
            T.onkeypress=function(e){
                n=Number(new Date());
                I.push(N?((n-N)/10).toFixed(0):0,e.charCode||e.keyCode);
                N=n
            };
            C.onclick=function(){
                I=[];
                S=[];
                T.value='';
                N=J=K=0
            };
            P.onclick=function(){
                alert('I:' + I + '\n\nS:' + S);
                T.value='';
                R(1)
            };
            function R(i){
                if(c=I[i++]){
                    if(v=X[c]?X[c]():eval("'\\"+c.toString(8)+"'")){
                        T.value=T.value.slice(0,J)+v+T.value.slice(K,T.value.length);
                        J++;
                    }
                    K=S.indexOf(i)>=0&&X[c]?K:J;
                    T.focus();
                    T.setSelectionRange(J,K);
                    if(d=I[i++])
                        setTimeout('R('+i+')',d*10)
                }
            }
        </script>
	</body>
</html>

<!--
-->
