<!DOCTYPE HTML>
<html>
	<head>
		<title>JS1k Demo - 1019 bytes</title>
		<meta charset="utf-8"/>
	</head>
	<body>
		<canvas id="c"></canvas>
		<script>
        F=.95;Q=3;Z=10;T=240;B=63;L=21;S=3;D=40;K=.00002;with(Math){A=abs;R=random;_=floor;P=2*PI}C=document.body.children[0];C.width=C.height=W=H=600;N=[];M=[];I=-1;C.onmousedown=function(e){I=(G.getImageData(e.clientX,e.clientY,1,1).data[2]-1)/S;if(k=N[I])k.m=!k.m};C.onmousemove=function(e){if(k=N[I])with(k){x=e.clientX;y=e.clientY;v=0;w=0;m=0}};C.onmouseup=function(){I=-1};G=C.getContext('2d');for(i=0;i<B;N[i++]={x:W*R(),y:H*R(),v:0,w:0,m:1}){if((j=i%L)<_(L/2)){k=_(1+i/L)*L-1;M[i]=[k-j-1,k]}}setInterval(function(){with(G){clearRect(0,0,W,H);strokeRect(0,0,W,H);for(i=0;k=N[i];i++)with(k){if(m&&i!=I){for(j=0;o=N[j];j++)if((t=A(x-o.x)+A(y-o.y))<2*D&&i!=j){t*=t;v+=(x-o.x)/t;w+=(y-o.y)/t}if(M[i])for(j=0;o=N[M[i][j]];j++){t=A(x-o.x)+A(y-o.y);v-=r=K*(x-o.x)*t;w-=s=K*(y-o.y)*t;o.v+=j?r/Z:r;o.w+=j?s/Z:s}v*=F;w*=F;x=(x+v+W)%W;y=(y+w+H)%H}beginPath();if(M[i]){o=N[M[i][0]];p=N[M[i][1]];moveTo(o.x,o.y);quadraticCurveTo(x,y,p.x,p.y)}else{arc(x,y,D/3,0,P,0);fillStyle='rgb('+!m*T+','+m*T+','+(S*i+1)+')';fill()}stroke()}}},1)
        </script>
	</body>
</html>